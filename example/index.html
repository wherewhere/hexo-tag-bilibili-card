<html lang="zh-cn">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>hexo-tag-bilibili-card</title>
<meta name="description" content="一个 Hexo 插件，在你的文章中插入哔哩哔哩卡片，样式模仿和借鉴自哔哩哔哩">
<meta name="theme-color" content="#036ac4">

<script type="module" src="https://cdn.jsdelivr.net/npm/@fluentui/web-components/dist/web-components.min.js"></script>
<script src="../components/bilibili-card/bilibili-card.js" async></script>

<link href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/styles/vs.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
  let message, readme;
  let isLoading = false;
  async function loadReadme(message, readme) {
    if (isLoading) {
      return;
    }
    try {
      isLoading = true;
      message.textContent = "正在从 GitHub 拉取信息，请坐和放宽";
      const response = await fetch("../README.md");
      if (response.ok) {
        message.textContent = "拉取成功，正在解析";
        const content = await response.text();
        if (typeof (content) == "string" && content.length > 0) {
          message.textContent = "解析成功";
          const regex = /<!-- Example Start -->[\s\S]*<!-- Example End -->/;
            readme.innerHTML = marked.parse(content.replace(regex, "<example-card></example-card>"));
          hljs.highlightAll();
          message.remove();
          return;
        }
      }
      readme.innerHTML =
        `<h2>预览</h2>
        <example-card></example-card>`;
      message.remove();
    }
    catch (ex) {
      message.textContent = `出错了！${ex}`;
      readme.innerHTML =
        `<h2>预览</h2>
        <example-card></example-card>`;
    }
    finally {
      isLoading = false;
    }
  }
  class AboutContent extends HTMLElement {
    constructor() {
      super();
    }
    connectedCallback() {
      message = document.createElement("span");
      readme = document.createElement("div");
      readme.innerHTML = "如果这里什么也没有，请<a href=\"javascript:loadReadme(message, readme);\">刷新</a>页面";
      this.appendChild(message);
      this.appendChild(readme);
      loadReadme(message, readme);
    }
  }
  if (!customElements.get("about-content")) {
    customElements.define("about-content", AboutContent);
  }
</script>

<script>
  class ExampleCard extends HTMLElement {
    constructor() {
      super();
    }
    connectedCallback() {
      const root = document.createElement("div");
      root.style.display = "flex";
      root.style.flexDirection = "column";
      root.style.rowGap = "0.5rem";
      this.appendChild(root);
      const fluentTextArea = document.createElement("fluent-text-area");
      fluentTextArea.placeholder = `<bilibili-card></bilibili-card>`;
      fluentTextArea.resize = "vertical";
      fluentTextArea.setAttribute("rows", "4");
      fluentTextArea.style.width = "100%";
      fluentTextArea.innerText = "代码："
      root.appendChild(fluentTextArea);
      const card = document.createElement("fluent-card");
      root.appendChild(card);
      const gird = document.createElement("div");
      gird.style.display = "flex";
      gird.style.flexDirection = "column";
      gird.style.padding = "6px 9px";
      gird.style.rowGap = "6px";
      gird.innerHTML = `<label>显示：</label>`;
      card.appendChild(gird);
      const example = document.createElement("div");
      example.style.display = "block";
      example.style.border = "unset";
      gird.appendChild(example);
      fluentTextArea.valueChanged = (oldValue, newValue) => {
        if (newValue !== oldValue) {
          example.innerHTML = newValue;
        }
      };
      fluentTextArea.value =
        `<bilibili-card vid="BV1y54y1a768" type="video" title="【UWP】手把手教你安装 UWP 安装包" author="where-where"
          cover="http://i2.hdslb.com/bfs/archive/41bc750cb5011bb036e008a716a89158c7eb7bb5.jpg" duration="05:21"
          views="2.2万" danmakus="4" comments="78" favorites="252" coins="106" likes="287"
          info-types="views danmakus"></bilibili-card>`;
    }
  }
  if (!customElements.get("example-card")) {
    customElements.define("example-card", ExampleCard);
  }
</script>

<style>
  @import 'https://cdn.jsdelivr.net/gh/microsoft/fluentui-blazor@dev/src/Core/wwwroot/css/reboot.css';

  :root {
    --font-monospace: Consolas, "Courier New", "Liberation Mono", SFMono-Regular, Menlo, Monaco, monospace;
  }

  .layout {
    height: 100%;
    width: 100%;
    position: relative;
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .header {
    display: flex;
    z-index: 10;
    flex-shrink: 0;
    background-color: var(--accent-fill-rest);
    font-family: var(--body-font);
    font-weight: bold;
    font-size: var(--type-ramp-plus-1-font-size);
    line-height: var(--type-ramp-plus-1-line-height);
    color: var(--fill-color);
    align-items: center;
  }

  .header .header-gutters {
    display: flex;
    position: relative;
    align-items: center;
    width: 100%;
    margin: 0.5rem 1.5rem;
  }

  .content {
    height: 100%;
    overflow: auto;
    padding: 0.5rem 1.5rem;
  }

  img {
    max-width: 100%;
  }

  pre {
    margin-bottom: 0.5rem;
    border: calc(var(--stroke-width)* 1px) solid var(--neutral-stroke-rest);
    border-radius: calc(var(--control-corner-radius)* 1px);
  }

  footer {
    background: var(--neutral-layer-4);
    color: var(--neutral-foreground-rest);
    align-items: center;
    padding: 10px 10px;
  }

  footer a {
    color: var(--neutral-foreground-rest);
    text-decoration: none;
  }

  footer a:focus {
    outline: 1px dashed;
    outline-offset: 3px;
  }

  footer a:hover {
    text-decoration: underline;
  }

  .footer {
    display: flex;
    z-index: 10;
    flex-direction: row;
    font-family: var(--body-font);
    font-weight: normal;
    font-size: var(--type-ramp-minus-1-font-size);
    line-height: var(--type-ramp-minus-1-line-height);
  }
</style>

<div class="layout">
  <div class="header" style="height: 50px;">
    <div class="header-gutters">hexo-tag-bilibili-card</div>
    <div style="flex-grow: 1;"></div>
    <div title="刷新" onclick="javascript:loadReadme(message, readme)" style="display: flex; height: 32px; width: 32px; margin-right: 8px; border: unset; background: unset; justify-content: center; align-items: center; cursor: pointer;">
      <svg style="height: 20px; width: 20px; fill: var(--neutral-layer-1);" focusable="false" viewBox="0 0 16 16">
        <path
          d="M3 8a5 5 0 0 1 9-3h-2a.5.5 0 0 0 0 1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-1 0v1.53A5.99 5.99 0 0 0 2 8a6 6 0 0 0 11.98.54.5.5 0 0 0-1-.08A5 5 0 0 1 3 8Z">
        </path>
      </svg>
    </div>
  </div>
  <div class="content">
    <about-content></about-content>
  </div>
  <footer class="footer">
    <span>Copyright © 2017 - 2024 wherewhere. All Rights Reserved</span>
    <div style="flex-grow: 1;"></div>
    <a href="https://github.com/wherewhere/hexo-tag-bilibili-card" target="_blank" rel="noopener">Github</a>
  </footer>
</div>

</html>