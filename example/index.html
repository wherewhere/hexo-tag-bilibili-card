<html lang="zh-cn">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>hexo-tag-bilibili-card</title>
<meta name="description" content="一个 Hexo 插件，在你的文章中插入哔哩哔哩卡片，样式模仿和借鉴自哔哩哔哩">
<meta name="theme-color" content="#036ac4">

<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>

<script type="module" src="https://cdn.jsdelivr.net/npm/@fluentui/web-components/dist/web-components.min.js"></script>
<script src="../components/bilibili-card/bilibili-card.js" async></script>

<script>
  function replaceScript(id, src) {
    let script = document.getElementById(id);
    const parent = script.parentNode;
    script.remove();
    script = document.createElement("script");
    script.src = src;
    parent.appendChild(script);
  }
</script>

<link href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/styles/vs.min.css" rel="stylesheet" />
<script id="highlightjs-script"
  src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js"></script>
<script>
  if (typeof hljs === "undefined") {
    replaceScript("highlightjs-script", "https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10/build/highlight.min.js");
  }
</script>

<script id="marked-script" src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.min.js"></script>
<script>
  if (typeof marked === "undefined") {
    replaceScript("marked-script", "https://cdn.jsdelivr.net/gh/markedjs/marked/lib/marked.js");
  }
</script>

<script>
  class Properties {
    constructor() {
      this._isLoading = false;
    }
    get isLoading() {
      return this._isLoading;
    }
    set isLoading(value) {
      if (this._isLoading !== value) {
        const style = document.documentElement.style;
        if (value) {
          style.setProperty("--loading-display", 'unset');
          style.setProperty("--loaded-display", 'none');
        }
        else {
          style.setProperty("--loading-display", 'none');
          style.setProperty("--loaded-display", 'unset');
        }
        this._isLoading = value;
      }
    }
  }
  let message, readme;
  let properties = new Properties();
  async function loadReadme(message, readme) {
    if (properties.isLoading) {
      return;
    }
    try {
      properties.isLoading = true;
      message.textContent = "正在从 GitHub 拉取信息，请坐和放宽";
      const response = await fetch("../README.md");
      if (response.ok) {
        message.textContent = "拉取成功，正在获取内容";
        const content = await response.text();
        if (typeof (content) == "string" && content.length > 0) {
          const regex = /<!-- Example Start -->[\s\S]*<!-- Example End -->/;
            message.textContent = "获取成功，正在解析内容";
          let markdown = content.replace(regex, "<example-card></example-card>");
          try {
            readme.innerHTML = marked.parse(content.replace(regex, "<example-card></example-card>"));
            try { hljs.highlightAll(); } catch (_) { }
          }
          catch (_) {
            readme.innerHTML = markdown;
          }
          message.remove();
          return;
        }
      }
      readme.innerHTML =
        `<h2>预览</h2>
        <example-card></example-card>`;
      message.remove();
    }
    catch (ex) {
      message.textContent = `出错了！${ex}`;
      readme.innerHTML =
        `<h2>预览</h2>
        <example-card></example-card>`;
    }
    finally {
      properties.isLoading = false;
    }
  }
  class AboutContent extends HTMLElement {
    constructor() {
      super();
    }
    connectedCallback() {
      message = document.createElement("span");
      readme = document.createElement("div");
      readme.innerHTML = "如果这里什么也没有，请<a href=\"javascript:loadReadme(message, readme);\">刷新</a>页面";
      this.appendChild(message);
      this.appendChild(readme);
      loadReadme(message, readme);
    }
  }
  if (!customElements.get("about-content")) {
    customElements.define("about-content", AboutContent);
  }
</script>

<script>
  class ExampleCard extends HTMLElement {
    constructor() {
      super();
    }
    connectedCallback() {
      const root = document.createElement("div");
      root.style.display = "flex";
      root.style.flexDirection = "column";
      root.style.rowGap = "0.5rem";
      this.appendChild(root);
      const fluentTextArea = document.createElement("fluent-text-area");
      fluentTextArea.placeholder = `<bilibili-card></bilibili-card>`;
      fluentTextArea.resize = "vertical";
      fluentTextArea.setAttribute("rows", "4");
      fluentTextArea.style.width = "100%";
      fluentTextArea.innerText = "代码："
      root.appendChild(fluentTextArea);
      const card = document.createElement("fluent-card");
      root.appendChild(card);
      const gird = document.createElement("div");
      gird.style.display = "flex";
      gird.style.flexDirection = "column";
      gird.style.padding = "6px 9px";
      gird.style.rowGap = "6px";
      gird.innerHTML = `<label>显示：</label>`;
      card.appendChild(gird);
      const example = document.createElement("div");
      example.style.display = "block";
      example.style.border = "unset";
      gird.appendChild(example);
      fluentTextArea.valueChanged = (oldValue, newValue) => {
        if (newValue !== oldValue) {
          example.innerHTML = newValue;
        }
      };
      fluentTextArea.value =
        `<bilibili-card vid="BV1y54y1a768" type="video" title="【UWP】手把手教你安装 UWP 安装包" author="where-where"
          cover="http://i2.hdslb.com/bfs/archive/41bc750cb5011bb036e008a716a89158c7eb7bb5.jpg" duration="05:21"
          views="2.2万" danmakus="4" comments="78" favorites="252" coins="106" likes="287"
          info-types="views danmakus"></bilibili-card>`;
    }
  }
  if (!customElements.get("example-card")) {
    customElements.define("example-card", ExampleCard);
  }
</script>

<style>
  @import 'https://cdn.jsdelivr.net/gh/microsoft/fluentui-blazor@dev/src/Core/wwwroot/css/reboot.css';

  :root {
    --font-monospace: Consolas, "Courier New", "Liberation Mono", SFMono-Regular, Menlo, Monaco, monospace;
    --content-padding: 1.5rem;
    --loading-display: none;
    --loaded-display: unset;
  }

  @media (max-width: 767px) {
    :root {
      --content-padding: 1rem;
    }
  }

  .layout {
    width: 100%;
    height: 100%;
    position: relative;
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .header {
    display: flex;
    z-index: 10;
    flex-shrink: 0;
    background-color: var(--accent-fill-rest);
    font-family: var(--body-font);
    font-weight: bold;
    font-size: var(--type-ramp-plus-1-font-size);
    line-height: var(--type-ramp-plus-1-line-height);
    color: var(--fill-color);
    align-items: center;
  }

  .header .header-gutters {
    display: flex;
    position: relative;
    align-items: center;
    width: 100%;
    margin: 0.5rem var(--content-padding);
  }

  .header .header-refresh {
    display: flex;
    height: 100%;
    margin-right: calc(var(--content-padding) - 17px);
    padding: 17px;
    justify-content: center;
    align-items: center;
    fill: var(--fill-color);
  }

  .header .header-refresh .header-refresh-icon {
    display: var(--loaded-display);
  }

  .header .header-refresh .header-refresh-ring {
    display: var(--loading-display);
    width: 16px;
    height: 16px;
  }

  .header .header-refresh .header-refresh-ring::part(indeterminate-indicator-1) {
    stroke: var(--fill-color);
  }

  .content {
    height: 100%;
    overflow: auto;
    padding: 0.5rem var(--content-padding);
  }

  img {
    max-width: 100%;
  }

  pre {
    margin-bottom: 0.5rem;
    border: calc(var(--stroke-width) * 1px) solid var(--neutral-stroke-rest);
    border-radius: calc(var(--control-corner-radius) * 1px);
  }

  table {
    border-collapse: separate;
  }

  fluent-text-area textarea {
    width: 100%;
  }

  footer {
    background: var(--neutral-layer-4);
    color: var(--neutral-foreground-rest);
    align-items: center;
    padding: 10px 10px;
  }

  footer a {
    color: var(--neutral-foreground-rest);
    text-decoration: none;
  }

  footer a:focus {
    outline: 1px dashed;
    outline-offset: 3px;
  }

  footer a:hover {
    text-decoration: underline;
  }

  .footer {
    display: flex;
    z-index: 10;
    flex-direction: row;
    font-family: var(--body-font);
    font-weight: normal;
    font-size: var(--type-ramp-minus-1-font-size);
    line-height: var(--type-ramp-minus-1-line-height);
  }
</style>

<div class="layout">
  <div class="header" style="height: 50px;">
    <div class="header-gutters">hexo-tag-bilibili-card</div>
    <div style="flex-grow: 1;"></div>
    <a class="header-refresh" title="刷新" href="javascript:loadReadme(message, readme)">
      <svg class="header-refresh-icon" width="16" height="16" viewBox="0 0 18 18">
        <path
          d="M9 1.5C4.85786 1.5 1.5 4.85786 1.5 9C1.5 13.1421 4.85786 16.5 9 16.5C13.1421 16.5 16.5 13.1421 16.5 9C16.5 8.6236 16.4723 8.2538 16.4188 7.8923C16.3515 7.4382 16.6839 7 17.1429 7C17.5138 7 17.839 7.2562 17.8953 7.6228C17.9642 8.0718 18 8.5317 18 9C18 13.9706 13.9706 18 9 18C4.02944 18 0 13.9706 0 9C0 4.02944 4.02944 0 9 0C11.3051 0 13.4077 0.86656 15 2.29168V1.25C15 0.83579 15.3358 0.5 15.75 0.5C16.1642 0.5 16.5 0.83579 16.5 1.25V4.25C16.5 4.66421 16.1642 5 15.75 5H12.75C12.3358 5 12 4.66421 12 4.25C12 3.83579 12.3358 3.5 12.75 3.5H14.0991C12.7609 2.25883 10.9691 1.5 9 1.5Z">
        </path>
      </svg>
      <fluent-progress-ring class="header-refresh-ring"></fluent-progress-ring>
    </a>
  </div>
  <div class="content">
    <about-content></about-content>
  </div>
  <footer class="footer">
    <span>Copyright © 2017 - 2024 wherewhere. All Rights Reserved</span>
    <div style="flex-grow: 1;"></div>
    <a href="https://github.com/wherewhere/hexo-tag-bilibili-card" target="_blank" rel="noopener">Github</a>
  </footer>
</div>

</html>